---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(janitor)
library(tidyverse)
library(lubridate)
```

```{r}
england_players <- read_csv("england/england_rugby_stats.csv")
```

```{r}
england_players_names <- england_players %>% 
  mutate(surname = str_extract(name,
                              "[A-z-']+$"), .after = name) %>% 
  mutate(first_names = str_remove(name," [A-z-']+$"), .after = name) %>% 
  select(-name)



```


```{r}
england_players_births <- england_players_names %>% 
  mutate(born = str_remove_all(born,"\n")) %>% 
  # Extract Brith loctaion
  mutate(birth_location = 
           str_extract(born, "[^,0-9)][A-z- ]*[ A-z'-.?]+$"), .after = born) %>%
  # Extract Birth Date
  mutate(born_temp = 
           str_extract(born, "^[A-z0-9', ]*[0-9]{4}"), .after = born) %>% 
  # Flag if exact Birth date is unknown
  mutate(approx_brithdate = str_detect(born_temp, "circa") | 
           str_detect(born_temp, "[A-z]+ [0-9]{4}"), .after = born_temp) %>% 
  
  mutate(born_temp = str_remove(born_temp, "circa ")) %>% 
 mutate(birth_date = case_when(
   str_detect(born_temp, "[A-z0-9 ]+, [0-9]{4}") ~ mdy(born_temp),
   str_detect(born_temp, "[A-z]+ [0-9]{4}") ~ myd(born_temp, truncated = 1),
   TRUE ~ ymd(born_temp, truncated = 2)), .after = born 
 )
           
england_players_births <- england_players_births %>% 
  mutate(birth_location = coalesce(birth_location,"Not Available")) %>%
  mutate(birth_location = str_replace(birth_location, "[^a-z]\\?", "Not Available")) %>% 
  mutate(approx_birth_location = str_detect(birth_location, "\\?"), .after = birth_location) %>% 
  mutate(birth_location = str_remove(birth_location, "\\?")) %>% 
  select(-born, -born_temp)

england_players_births
```


```{r}
england_players_debut <- england_players_births %>% 
  mutate(debut_date = str_extract(debut, "[A-z 0-9]+, [0-9]{4}")) %>% 
  mutate(debut_match = str_extract(debut, "^[A-z -]+")) %>% 
  separate(debut_match, into = c("debut_match", "debut_location"), sep = " at ")

england_players_debut %>% 
  select(debut, debut_match, debut_date, debut_location)
```

